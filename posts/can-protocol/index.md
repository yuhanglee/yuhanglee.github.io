# CAN协议



## CAN总线定义
![can协议](images/CAN-bus.jpg)


一直都说，CAN总线是汽车上最重要的总线接口之一。那么，CAN总线是什么呢？


&gt; 什么是CAN总线?


你的汽车就像一个人的身体:控制器区域网络(CAN总线)是神经系统，实现通信。反过来，“节点”或“电子控制单元”(ecu)就像身体的一部分，通过CAN总线相互连接。一部分感知到的信息可以与另一部分共享。

![can总线](images/CAR&amp;BUS.jpg &#39;hello&#39;)


&gt; 什么是ECU

在汽车CAN总线系统中，ECU可以是发动机控制单元、安全气囊、音响系统等。一辆现代汽车可能有多个ECU，每个ECU都有可能需要与其他网络部分共享的信息。

![ECU](images/ECU_Trans.png)

这就是CAN标准排得上用场的地方：
- CAN总线可以连接多个ECU，并进行通信
- 使用双绞线，无复杂的专用布线，网络拓展性强
- 支持仲裁和抢占，以及可以报告错误帧
- 支持一对一和一对多通信


## OSI网络

用更专业的术语来说，CAN(controller area network)是由数据链路层和物理层来描述，在高速CAN中，`ISO 11898-1` 描述了数据链路层，`ISO 11898-2` 描述了物理层，如图所示，CAN的作用经常出现在7层OSI中。

CAN总线物理层定义了电路类型、电信号水平、节点要求、电缆阻抗等。例如：`ISO 11898-2`规定了许多事情，包括以下内容
- 波特率： CAN节点必须使用两根绞线相连，经典CAN最高可以达到1Mbps，CANFD数据域最高可以达到5Mbps
- 电缆长度： 最大的长度可以达到 500米（125Kbps）或者40米（1Mbps）
- 终端： CAN总线两端必须都正确的使用120欧姆终端电阻

![OSI分层](images/OSI-layer.png)


## 高速CAN

在汽车总线的定义中，会经常遇到不同类型的网络：下面我们提供一个简单的概述：

- 高速CAN总线： 本文的重点是高速CAN总线(ISO 11898)。它是迄今为止物理层最流行的CAN标准协议，波特率支持从40Kbps到1Mbps。只需要简单的双绞线，就可以满足简单的汽车应用。还可以作为OBD，J1939，NMEA 2000，CANOpen等高层协议的基础。第二代CAN被称为CANFD，数据域可以最高支持5Mbps。
- 低速CAN总线： 该标准支持的波特率较低，为40Kbps到125Kbps，且可以允许在两条总线出现故障之后，继续进行通信。因此，也被称为&#34;容错CAN&#34;。
- LIN总线： LIN总线是CAN总线的低成本补充，其只需要3根线就可以完成通信，可以进行更加简单的布线和更经济的网络。
- 以太网： 当今随着新能源的崛起，车辆功能越来越复杂。新能源车辆以支持ADAS(高级驾驶辅助系统)、信息娱乐系统、摄像头等高带宽要求。与CAN总线相比，汽车以太网提供了更高的数据传入速率，但缺乏经典CAN和CAN FD的一些安全/性能的特征。未来一段时间，CAN、CAN FD、CAN XL和以太网基友可能同事应用于新的汽车和工业开发。

## CAN总线优点

由于CAN总线具有以下优点，CAN总线标准几乎用于所有车辆和许多场景。

&gt; 简单，低成本

ECU可以通过单个CAN系统进行通信，而不使用更加复杂的模拟信号总线，从而减少了错误、复杂、布线、成本。

&gt; 集中

CAN总线提供了与所有ECU网络通信的入口点，且不分主从，可以进行双向通信，从而实现中央诊断、数据记录和配置。

&gt; 健壮

该系统对电气干扰和电磁干扰具有鲁棒性，是安全关键应用的理想选择

&gt; 高效

CAN具有仲裁性，数据报文可以按照ID确定优先级，以便最高优先级的数据得到立即总线访问，而不会导致其他帧的中断。





---

> 作者: [liyuhang](https://github.com/yuhanglee)  
> URL: https://yuhanglee.github.io/posts/can-protocol/  

